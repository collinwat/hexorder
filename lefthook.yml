# Hexorder Git Hooks â€” managed by lefthook
# See docs/git-guide.md for the conventions these hooks enforce.
#
# Setup: mise install && lefthook install

commit-msg:
  commands:
    validate-format:
      run: |
        msg=$(cat "{1}")
        # Validate conventional commit format: type(scope): summary
        if ! echo "$msg" | head -1 | grep -qE '^(feat|fix|refactor|test|docs|chore|style)\((unit|cell|hex_grid|camera|game_system|editor_ui|contracts|project)\): .+$'; then
          echo ""
          echo "ERROR: Commit message does not match required format."
          echo ""
          echo "  Expected: <type>(<scope>): <summary>"
          echo ""
          echo "  Types:  feat | fix | refactor | test | docs | chore | style"
          echo "  Scopes: unit | cell | hex_grid | camera | game_system | editor_ui | contracts | project"
          echo ""
          echo "  Rules:"
          echo "    - Imperative mood, lowercase, no trailing period"
          echo "    - Max 72 characters on subject line"
          echo ""
          echo "  Got: $(head -1 "{1}")"
          echo ""
          exit 1
        fi
        # Validate subject line length (max 72 characters)
        subject=$(head -1 "{1}")
        if [ ${#subject} -gt 72 ]; then
          echo ""
          echo "ERROR: Subject line exceeds 72 characters (${#subject} chars)."
          echo "  Got: $subject"
          echo ""
          exit 1
        fi

pre-commit:
  parallel: false
  commands:
    gitleaks:
      run: mise exec -- gitleaks protect --staged --no-banner --baseline-path .gitleaks-baseline.json
    check-formatting:
      run: cargo fmt --all -- --check
    check-compiles:
      run: cargo build
      tags: slow
